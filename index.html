 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DayZ Text Adventure</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

.material-symbols-outlined {
    font-family: 'Material Symbols Outlined';
    font-variation-settings:
        'FILL' 0,
        'wght' 400,
        'GRAD' 0,
        'opsz' 24;
}

html, body {
    height: 100%;
    overflow-x: hidden; /* Prevent horizontal scroll */
}

body {
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
    color: #ecf0f1;
    padding: 20px;
    min-height: 100vh;
}

.game-container {
    max-width: 1200px;
    width: 100%;
    margin: 0 auto;
    background: rgba(0, 0, 0, 0.95);
    border-radius: 8px;
    padding: 20px;
    min-height: calc(100vh - 40px);
}

.title {
    text-align: center;
    font-size: 2.5em;
    color: #e74c3c;
    margin-bottom: 30px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

.stats-bar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
    padding: 20px;
    background: rgba(15, 15, 15, 0.8);
    border-radius: 8px;
}

.stat {
    text-align: center;
}

.stat-label {
    font-size: 0.9em;
    color: #bdc3c7;
    margin-bottom: 8px;
    font-weight: bold;
}

.stat-bar {
    height: 24px;
    background: rgba(44, 62, 80, 0.8);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #34495e;
    position: relative;
}

.stat-fill {
    height: 100%;
    transition: width 0.3s ease, background-color 0.3s ease;
    border-radius: 12px;
}

.health-fill { background: linear-gradient(90deg, #e74c3c, #c0392b); }
.hunger-fill { background: linear-gradient(90deg, #f39c12, #d68910); }
.thirst-fill { background: linear-gradient(90deg, #3498db, #2980b9); }

.location-info {
    background: rgba(10, 10, 10, 0.9);
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 25px;
    border-left: 4px solid #e74c3c;
}

.location-name {
    font-size: 1.8em;
    color: #e74c3c;
    margin-bottom: 15px;
    font-weight: bold;
}

#location-description {
    margin-bottom: 16px;
    line-height: 1.6;
    font-size: 1.1em;
}

.story-text {
    background: rgba(20, 20, 20, 0.8);
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 25px;
    line-height: 1.6;
    font-size: 1em;
    min-height: 120px;
}

.actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.action-btn {
    background: linear-gradient(135deg, #34495e, #2c3e50);
    color: #ecf0f1;
    border: none;
    padding: 15px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-family: inherit;
    font-size: 1em;
    font-weight: bold;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    min-height: 50px;
}

.action-btn:hover {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    border-color: #e74c3c;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.inventory {
    background: rgba(26, 37, 47, 0.6);
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 25px;
}

.inventory-title {
    color: #e74c3c;
    margin-bottom: 15px;
    font-size: 1.3em;
    font-weight: bold;
}

.inventory-items {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    min-height: 50px;
}

.inventory-item {
    background: rgba(52, 73, 94, 0.8);
    padding: 10px 15px;
    border-radius: 6px;
    font-size: 0.9em;
    border: 1px solid #34495e;
    transition: all 0.3s ease;
}

.inventory-item.equipped {
    background: rgba(46, 204, 113, 0.8);
    border-color: #27ae60;
    font-weight: bold;
}

.inventory-item:hover {
    background: rgba(231, 76, 60, 0.8);
    border-color: #e74c3c;
    transform: scale(1.05);
}

.map-container {
    background: rgba(10, 10, 10, 0.9);
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 25px;
}

.map-title {
    color: #3498db;
    margin-bottom: 20px;
    font-size: 1.4em;
    text-align: center;
    font-weight: bold;
}

.map {
    position: relative;
    width: 100%;
    max-width: 800px;
    height: 500px;
    margin: 0 auto;
    background-image: url('map.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 8px;
    border: 2px solid #34495e;
}

.map-location {
    position: absolute;
    width: 32px;
    height: 32px;
    background: rgba(52, 73, 94, 0.8);
    border: 2px solid #34495e;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    color: #ecf0f1;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    font-weight: bold;
}

.map-location:hover {
    background: rgba(46, 204, 113, 0.8);
    border-color: #27ae60;
    transform: scale(1.3);
    z-index: 10;
}

.map-location.current {
    background: rgba(231, 76, 60, 0.8);
    border-color: #e74c3c;
    color: #fff;
    font-weight: bold;
    animation: pulse-location 2s infinite;
    z-index: 5;
}

.map-location.connected {
    background: rgba(46, 204, 113, 0.6);
    border-color: #27ae60;
    cursor: pointer;
}

.map-location.connected:hover {
    background: rgba(46, 204, 113, 0.8);
    transform: scale(1.3);
    z-index: 10;
}

@keyframes pulse-location {
    0%, 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
    50% { box-shadow: 0 0 0 12px rgba(231, 76, 60, 0); }
}

/* Map location positions */
.map-berezino { top: 32%; left: 81%; }
.map-svetlojarsk { top: 10%; left: 89%; }
.map-novodmitrovsk { top: 3%; left: 73%; }
.map-severograd { top: 12%; left: 50%; }
.map-solnichniy { top: 54%; left: 83%; }
.map-kamyshovo { top: 71%; left: 76%; }
.map-elektro { top: 81%; left: 65%; }
.map-prigorodki { top: 74%; left: 58%; }
.map-cherno { top: 76%; left: 45%; }
.map-balota { top: 74%; left: 31%; }
.map-komarovo { top: 82%; left: 21%; }
.map-kamenka { top: 81%; left: 10%; }
.map-zelenogorsk { top: 61%; left: 14%; }
.map-vybor { top: 38%; left: 22%; }
.map-novy_sobor { top: 45%; left: 44%; }
.map-myshkino { top: 49%; left: 7%; }
.map-nwaf { top: 28%; left: 27%; }
.map-tisy { top: 6%; left: 8%; }
.map-novaya_petrovka { top: 12%; left: 20%; }
.map-lopatino { top: 31%; left: 16%; }
.map-kamensk { top: 8%; left: 15%; }
.map-krasnostav { top: 15%; left: 70%; }
.map-gorka { top: 25%; left: 65%; }
.map-polana { top: 35%; left: 60%; }
.map-rify { top: 20%; left: 85%; }
.map-stary_sobor { top: 40%; left: 35%; }
.map-kabanino { top: 35%; left: 30%; }
.map-guglovo { top: 55%; left: 50%; }
.map-mogilevka { top: 60%; left: 40%; }
.map-staroye { top: 65%; left: 55%; }
.map-tulga { top: 68%; left: 80%; }
.map-pavlovo { top: 70%; left: 25%; }
.map-kozlovka { top: 65%; left: 20%; }
.map-pogorevka { top: 55%; left: 18%; }

.danger {
    color: #e74c3c;
    font-weight: bold;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.game-over {
    text-align: center;
    color: #e74c3c;
    font-size: 1.8em;
    padding: 30px;
    background: rgba(231, 76, 60, 0.2);
    border-radius: 8px;
    margin: 25px 0;
    border: 2px solid #e74c3c;
}

.timer-container {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.85);
    z-index: 9999;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease;
}

.timer-text {
    color: #ecf0f1;
    font-size: 1.2em;
    margin-bottom: 20px;
    text-align: center;
}

.timer-bar {
    height: 25px;
    background: rgba(44, 62, 80, 0.8);
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid #34495e;
    width: 400px;
}

.timer-fill {
    height: 100%;
    background: linear-gradient(90deg, #e74c3c, #c0392b);
    width: 100%;
    transition: width 0.15s linear;
    border-radius: 12px;
}

.tooltip {
    position: absolute;
    background: rgba(26, 46, 47, 0.95);
    color: #ecf0f1;
    padding: 10px 15px;
    border-radius: 6px;
    border: 1px solid #e74c3c;
    font-size: 0.9em;
    max-width: 250px;
    line-height: 1.4;
    z-index: 1000;
    pointer-events: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    display: none;
}

.tooltip::before {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 8px solid transparent;
    border-top-color: #e74c3c;
}

a { 
    color: #f1c40f; 
    text-decoration: none;
    font-weight: bold;
}

a:hover {
    color: #f39c12;
    text-decoration: underline;
}

#health-text, #hunger-text, #thirst-text {
    display: none;
}

#start {
    width: 100%;
    height: 100vh;
    background-color: rgba(0,0,0,0.9);
    text-align: center;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 99999;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

#startBtn {
    margin-top: 2em;
    border: 3px solid white;
    background-color: #27ae60;
    padding: 15px 30px;
    font-size: 1.8em;
    cursor: pointer;
    color: white;
    transition: all 0.2s ease;
    border-radius: 8px;
    font-weight: bold;
    font-family: inherit;
}

#startBtn:hover {
    transform: scale(1.05) rotate(1deg);
    background-color: #e67e22;
    box-shadow: 0 5px 15px rgba(231, 126, 34, 0.4);
}

/* Custom scrollbar */
*::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

*::-webkit-scrollbar-track {
    background-color: #2c3e50;
    border-radius: 4px;
}

*::-webkit-scrollbar-thumb {
    background-color: #e74c3c;
    border-radius: 4px;
    border: 1px solid #2c3e50;
}

*::-webkit-scrollbar-thumb:hover {
    background-color: #c0392b;
}

/* Mobile Responsive Design */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }

    .game-container {
        padding: 15px;
        min-height: calc(100vh - 20px);
    }

    .title {
        font-size: 2em;
        margin-bottom: 20px;
    }

    .stats-bar {
        grid-template-columns: 1fr;
        gap: 10px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .stat-bar {
        height: 20px;
    }

    .location-info {
        padding: 20px;
        margin-bottom: 20px;
    }

    .location-name {
        font-size: 1.5em;
        margin-bottom: 10px;
    }

    .story-text {
        padding: 20px;
        margin-bottom: 20px;
        min-height: 100px;
        font-size: 0.95em;
    }

    .actions {
        grid-template-columns: 1fr;
        gap: 12px;
        margin-bottom: 20px;
    }

    .action-btn {
        padding: 12px 15px;
        font-size: 0.9em;
        min-height: 45px;
    }

    .inventory {
        padding: 15px;
        margin-bottom: 20px;
    }

    .inventory-title {
        font-size: 1.2em;
        margin-bottom: 12px;
    }

    .inventory-item {
        padding: 8px 12px;
        font-size: 0.85em;
    }

    .map-container {
        padding: 15px;
        margin-bottom: 20px;
    }

    .map {
        height: 300px;
        max-width: 100%;
    }

    .map-location {
        width: 24px;
        height: 24px;
        font-size: 0.7em;
    }

    .timer-bar {
        width: 280px;
        height: 20px;
    }

    .timer-text {
        font-size: 1em;
        margin-bottom: 15px;
    }

    .tooltip {
        max-width: 200px;
        font-size: 0.8em;
        padding: 8px 12px;
    }

    #startBtn {
        font-size: 1.5em;
        padding: 12px 25px;
    }
}

@media (max-width: 480px) {
    .title {
        font-size: 1.6em;
    }

    .stats-bar {
        padding: 12px;
    }

    .location-name {
        font-size: 1.3em;
    }

    .story-text {
        padding: 15px;
        font-size: 0.9em;
    }

    .action-btn {
        font-size: 0.85em;
        padding: 10px 12px;
    }

    .map {
        height: 250px;
    }

    .map-location {
        width: 20px;
        height: 20px;
        font-size: 0.6em;
    }

    .timer-bar {
        width: 240px;
    }

    #startBtn {
        font-size: 1.3em;
        padding: 10px 20px;
    }
}
</style>
</head>
<body>
    <div id="start">
        <br /><br />
        <h1>TextZ</h1>
        <br /><br />
        <p>A super simple singleplayer text-adventure version of DayZ.</p>
        <br /><br />
        <p style="text-align: left; width: 80%; margin-left: 10%;">
          <strong>Notes:</strong><br />
          - Your hunger &amp; thirst depletes 1 unit every 4 in-game ticks.<br />
          - Performing actions causes depletion (except eating/drinking).<br />
          - Travelling to a new location uses more food/drink.<br />
          - Chance of being infected from zombie, requires antibiotics.<br />
          - Decrease infection chance &amp; increase damage by equipping a weapon.<br />
          - To drop a weapon, click it in your inventory.<br />
          - To equip a weapon, click the weapons' equip button.<br />
          - Your score increases as you do actions and survive.<br />
          - Refresh to start again.<br />
        </p>
        <br /><br />
        <p>By Barrie</p>
        <button id="startBtn">Start Game</button>
    </div>
    <div class="game-container">
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-bar">
                    <div class="stat-fill health-fill" id="health-bar">Health</div>
                </div>
                <div id="health-text">100/100</div>
            </div>
            <div class="stat">
                <div class="stat-bar">
                    <div class="stat-fill hunger-fill" id="hunger-bar">Hunger</div>
                </div>
                <div id="hunger-text">100/100</div>
            </div>
            <div class="stat">
                <div class="stat-bar">
                    <div class="stat-fill thirst-fill" id="thirst-bar">Thirst</div>
                </div>
                <div id="thirst-text">100/100</div>
            </div>
            <div class="stat">
                <div id="score-text">0</div>
            </div>
        </div>
        
        <div class="tooltip" id="tooltip"></div>
        
        <div class="location-info">
            <div class="location-name" id="location-name">Elektrozavodsk</div>
            <div id="location-description">You find yourself in the coastal city of Elektro. The sound of waves crashes nearby, but the empty streets tell a different story.</div>
            <div class="actions" id="action-buttons"></div>
        </div>
        
        <div class="story-text" id="story-text">
            You awake on the shores of Chernarus in <span id="start-location"></span>, survivor. The infection has spread, and you're one of the few left alive. Your stomach growls with hunger, your throat is dry, and you can hear the distant moans of the infected. You must survive.
        </div>
        
        <div class="inventory">
            <div class="inventory-title">Inventory</div>
            <div class="inventory-items" id="inventory-items">
                <div class="inventory-item">Empty Hands</div>
            </div>
        </div>
        
        <div class="map-container">
            <div class="map" id="map">
                <svg class="map-roads" width="600" height="400"></svg>
                
                <!-- Northeast Region -->
                <div class="map-location map-tisy" id="map-tisy" onclick="game.mapTravel('tisy')" data-tooltip="Tisy: A heavily fortified military base with underground bunkers. Extremely dangerous.">Ti</div>
                <div class="map-location map-kamensk" id="map-kamensk" onclick="game.mapTravel('kamensk')" data-tooltip="Kamensk: A military town near Tisy base. Barracks and vehicle depots line the streets.">Km</div>
                <div class="map-location map-krasnostav" id="map-krasnostav" onclick="game.mapTravel('krasnostav')" data-tooltip="Krasnostav: A large northeastern town with an airfield and police station.">Kr</div>
                <div class="map-location map-novaya_petrovka" id="map-novaya_petrovka" onclick="game.mapTravel('novaya_petrovka')" data-tooltip="Novaya Petrovka: The most North-Western town in Chernarus.">Np</div>
                <div class="map-location map-severograd" id="map-severograd" onclick="game.mapTravel('severograd')" data-tooltip="Severograd: A northern industrial town with factories and a hospital.">Sv</div>
                
                <!-- Northwest Region -->
                <div class="map-location map-lopatino" id="map-lopatino" onclick="game.mapTravel('lopatino')" data-tooltip="Lopatino: A small village close to the NWAF.">Lo</div>
                <div class="map-location map-nwaf" id="map-nwaf" onclick="game.mapTravel('nwaf')" data-tooltip="NWAF: The North-West Airfield is a very dangerous military area.">Nw</div>
                
                <!-- Central-North Region -->
                <div class="map-location map-gorka" id="map-gorka" onclick="game.mapTravel('gorka')" data-tooltip="Gorka: A hillside town with a military checkpoint overlooking valleys.">G</div>
                <div class="map-location map-polana" id="map-polana" onclick="game.mapTravel('polana')" data-tooltip="Polana: A factory town with large industrial buildings and worker housing.">Pl</div>
                
                <!-- Coastal Northeast -->
                <div class="map-location map-svetlojarsk" id="map-svetlojarsk" onclick="game.mapTravel('svetlojarsk')" data-tooltip="Svetlojarsk: A coastal town in the north with homes and small businesses.">S</div>
                <div class="map-location map-rify" id="map-rify" onclick="game.mapTravel('rify')" data-tooltip="Rify: A small coastal village with fishing boats. The sea breeze carries eerie silence.">R</div>
                <div class="map-location map-berezino" id="map-berezino" onclick="game.mapTravel('berezino')" data-tooltip="Berezino: A coastal town with residential buildings and a hospital.">B</div>
                <div class="map-location map-novodmitrovsk" id="map-novodmitrovsk" onclick="game.mapTravel('novodmitrovsk')" data-tooltip="Novodmitrovsk: A large industrial city in the northeast.">N</div>
                
                <!-- Central Region -->
                <div class="map-location map-stary_sobor" id="map-stary_sobor" onclick="game.mapTravel('stary_sobor')" data-tooltip="Stary Sobor: An old town with a military tent camp. Former major military staging area.">SS</div>
                <div class="map-location map-kabanino" id="map-kabanino" onclick="game.mapTravel('kabanino')" data-tooltip="Kabanino: A small village with scattered houses and a school.">Kb</div>
                <div class="map-location map-vybor" id="map-vybor" onclick="game.mapTravel('vybor')" data-tooltip="Vybor: A central town with a nearby military base. High-value loot but heavily infested.">V</div>
                <div class="map-location map-novy_sobor" id="map-novy_sobor" onclick="game.mapTravel('novy_sobor')" data-tooltip="Novy Sobor: An inland village with a church and small market.">NS</div>
                
                <!-- Central-South Region -->
                <div class="map-location map-guglovo" id="map-guglovo" onclick="game.mapTravel('guglovo')" data-tooltip="Guglovo: A rural village surrounded by farmland and forests.">Gu</div>
                <div class="map-location map-mogilevka" id="map-mogilevka" onclick="game.mapTravel('mogilevka')" data-tooltip="Mogilevka: A farming community with barns and agricultural equipment.">Mo</div>
                <div class="map-location map-staroye" id="map-staroye" onclick="game.mapTravel('staroye')" data-tooltip="Staroye: An old village with traditional houses and a small church.">St</div>
                
                <!-- Eastern Coast -->
                <div class="map-location map-solnichniy" id="map-solnichniy" onclick="game.mapTravel('solnichniy')" data-tooltip="Solnichniy Factory: An industrial area with large factory buildings.">SF</div>
                <div class="map-location map-tulga" id="map-tulga" onclick="game.mapTravel('tulga')" data-tooltip="Tulga: A hillside village overlooking the coast. Isolated but scenic.">Tu</div>
                <div class="map-location map-kamyshovo" id="map-kamyshovo" onclick="game.mapTravel('kamyshovo')" data-tooltip="Kamyshovo: A small coastal town with a few houses and a dock.">K</div>
                
                <!-- Southern Coast -->
                <div class="map-location map-elektro" id="map-elektro" onclick="game.mapTravel('elektro')" data-tooltip="Elektrozavodsk: A coastal city with industrial and residential areas.">E</div>
                <div class="map-location map-prigorodki" id="map-prigorodki" onclick="game.mapTravel('prigorodki')" data-tooltip="Prigorodki: A small suburb near Elektrozavodsk.">P</div>
                <div class="map-location map-cherno" id="map-cherno" onclick="game.mapTravel('cherno')" data-tooltip="Chernogorsk: A large coastal city with apartment buildings and shops.">C</div>
                
                <!-- Southwest Region -->
                <div class="map-location map-balota" id="map-balota" onclick="game.mapTravel('balota')" data-tooltip="Balota Airfield: An abandoned airfield with hangars and barracks.">BA</div>
                <div class="map-location map-komarovo" id="map-komarovo" onclick="game.mapTravel('komarovo')" data-tooltip="Komarovo: A small coastal village with quaint houses.">Ko</div>
                <div class="map-location map-kamenka" id="map-kamenka" onclick="game.mapTravel('kamenka')" data-tooltip="Kamenka: A remote coastal village at the edge of Chernarus.">Ka</div>
                
                <!-- Western Region -->
                <div class="map-location map-pavlovo" id="map-pavlovo" onclick="game.mapTravel('pavlovo')" data-tooltip="Pavlovo: A military town with a base and vehicle maintenance facilities.">Pv</div>
                <div class="map-location map-kozlovka" id="map-kozlovka" onclick="game.mapTravel('kozlovka')" data-tooltip="Kozlovka: A small western village with a few houses and a store.">Kz</div>
                <div class="map-location map-pogorevka" id="map-pogorevka" onclick="game.mapTravel('pogorevka')" data-tooltip="Pogorevka: A remote village in the western forests. Very quiet and isolated.">Po</div>
                <div class="map-location map-zelenogorsk" id="map-zelenogorsk" onclick="game.mapTravel('zelenogorsk')" data-tooltip="Zelenogorsk: An inland town with a military checkpoint. Good for military gear but risky.">Z</div>
                <div class="map-location map-myshkino" id="map-myshkino" onclick="game.mapTravel('myshkino')" data-tooltip="Myshkino: A remote western village surrounded by forests.">M</div>
            </div>
        </div>

        <div class="actions" id="actions">
            <!-- Actions will be populated by JavaScript -->
        </div>
    </div>
    <div class="timer-container" id="timer-container">
        <div class="timer-text" id="timer-text">Using item...</div>
        <div class="timer-bar">
            <div class="timer-fill" id="timer-fill"></div>
        </div>
    </div>
    <script>
        class Game {
            constructor() {
                // Define possible spawn locations
                const spawnLocations = [
                  'elektro', 
                  'svetlojarsk', 
                  'elektro', 
                  'kamyshovo', 
                  'cherno', 
                  'komarovo', 
                  'solnichniy',
                  'berezino',
                  'rify',
                ];
                // Randomly select a spawn location
                const randomSpawn = spawnLocations[Math.floor(Math.random() * spawnLocations.length)];

                this.player = {
                    health: 100,
                    hunger: 50,
                    thirst: 50,
                    inventory: ['fresh_fruit'],
                    location: randomSpawn,
                    equippedWeapon: null,
                    baseDamage: 10,
                    infection: false,         // Tracks infection status
                    inventoryCapacity: 8,     // Default capacity,
                    score: 0
                };

                this.weapons = {
                    brassKnuckles: { name: 'Brass Knuckles', damage: 10 },
                    knife: { name: 'Knife', damage: 20 },
                    pistol: { name: 'P1 Pistol', damage: 30 },
                    glock: { name: 'Glock Pistol', damage: 35 },
                    mosinRifle: { name: 'Mosin Rifle', damage: 50 }
                };
                
                this.locations = {
                    // Northwest Region
                    lopatino: {
                        name: 'Lopatino',
                        description: 'A small village close to the NWAF. Abandoned houses dot the landscape.',
                        connections: ['nwaf', 'novaya_petrovka', 'vybor', 'myshkino'],
                        lootTable: {
                            canned_food: 0.15,
                            protein_bar: 0.1,
                            water_bottle: 0.15,
                            soda_can: 0.1,
                            bandage: 0.1,
                            knife: 0.05,
                            fresh_fruit: 0.1
                        },
                        zombieChance: 0.3
                    },
                    novaya_petrovka: {
                        name: 'Novaya Petrovka',
                        description: 'The most North-Western town in Chernarus. Directly above the NWAF.',
                        connections: ['nwaf', 'tisy', 'severograd', 'lopatino', 'kamensk'],
                        lootTable: {
                            canned_food: 0.15,
                            protein_bar: 0.1,
                            water_bottle: 0.15,
                            soda_can: 0.1,
                            bandage: 0.1,
                            knife: 0.05,
                            junk: 0.05
                        },
                        zombieChance: 0.3
                    },
                    nwaf: {
                        name: 'NWAF',
                        description: 'The North-West Airfield is a very dangerous military area with barracks and hangars.',
                        connections: ['vybor', 'tisy', 'lopatino', 'novaya_petrovka', 'kabanino'],
                        lootTable: {
                            military_rations: 0.2,
                            energy_drink: 0.15,
                            medical_supplies: 0.15,
                            pistol: 0.12,
                            rifle: 0.08,
                            knife: 0.1,
                            mosinRifle: 0.1,
                            backpack: 0.1,
                            antibiotics: 0.1
                        },
                        zombieChance: 0.5
                    },
                    tisy: {
                        name: 'Tisy',
                        description: 'A heavily fortified military base with underground bunkers. Extremely dangerous.',
                        connections: ['nwaf', 'novaya_petrovka', 'kamensk'],
                        lootTable: {
                            military_rations: 0.25,
                            energy_drink: 0.15,
                            medical_supplies: 0.2,
                            pistol: 0.1,
                            rifle: 0.15,
                            knife: 0.1,
                            mosinRifle: 0.1,
                            backpack: 0.05
                        },
                        zombieChance: 0.6
                    },
                    
                    // Northeast Region
                    kamensk: {
                        name: 'Kamensk',
                        description: 'A military town near Tisy base. Barracks and vehicle depots line the streets.',
                        connections: ['tisy', 'severograd', 'krasnostav', 'novaya_petrovka'],
                        lootTable: {
                            military_rations: 0.2,
                            energy_drink: 0.1,
                            medical_supplies: 0.15,
                            pistol: 0.1,
                            rifle: 0.1,
                            junk: 0.1,
                            backpack: 0.05
                        },
                        zombieChance: 0.45
                    },
                    krasnostav: {
                        name: 'Krasnostav',
                        description: 'A large northeastern town with an airfield and police station.',
                        connections: ['kamensk', 'severograd', 'svetlojarsk', 'berezino'],
                        lootTable: {
                            canned_food: 0.2,
                            protein_bar: 0.15,
                            water_bottle: 0.15,
                            energy_drink: 0.1,
                            medical_supplies: 0.1,
                            pistol: 0.12,
                            junk: 0.08,
                            backpack: 0.1
                        },
                        zombieChance: 0.4
                    },
                    
                    // Central-East Region
                    gorka: {
                        name: 'Gorka',
                        description: 'A hillside town with a military checkpoint. Strategic position overlooking valleys.',
                        connections: ['severograd', 'polana', 'berezino'],
                        lootTable: {
                            military_rations: 0.15,
                            canned_food: 0.15,
                            water_bottle: 0.15,
                            medical_supplies: 0.1,
                            pistol: 0.1,
                            knife: 0.1,
                            junk: 0.1,
                            backpack: 0.05
                        },
                        zombieChance: 0.35
                    },
                    polana: {
                        name: 'Polana',
                        description: 'A factory town with large industrial buildings and worker housing.',
                        connections: ['gorka', 'berezino', 'solnichniy'],
                        lootTable: {
                            canned_food: 0.15,
                            protein_bar: 0.1,
                            water_bottle: 0.15,
                            junk: 0.2,
                            bandage: 0.1,
                            knife: 0.1,
                            energy_drink: 0.1
                        },
                        zombieChance: 0.3
                    },
                    
                    // Coastal Towns
                    rify: {
                        name: 'Rify',
                        description: 'A small coastal village with fishing boats. The sea breeze carries an eerie silence.',
                        connections: ['berezino', 'svetlojarsk', 'solnichniy'],
                        lootTable: {
                            canned_food: 0.2,
                            fresh_fruit: 0.15,
                            water_bottle: 0.2,
                            fishing_rod: 0.2,
                            knife: 0.1,
                            bandage: 0.1,
                            soda_can: 0.05
                        },
                        zombieChance: 0.2
                    },
                    
                    // Central Region
                    stary_sobor: {
                        name: 'Stary Sobor',
                        description: 'An old town with a military tent camp. Once a major military staging area.',
                        connections: ['novy_sobor', 'kabanino', 'guglovo', 'vybor'],
                        lootTable: {
                            military_rations: 0.18,
                            energy_drink: 0.12,
                            medical_supplies: 0.15,
                            pistol: 0.1,
                            rifle: 0.1,
                            junk: 0.1,
                            bandage: 0.15
                        },
                        zombieChance: 0.5
                    },
                    kabanino: {
                        name: 'Kabanino',
                        description: 'A small village with scattered houses and a school.',
                        connections: ['stary_sobor', 'vybor', 'novy_sobor', 'nwaf'],
                        lootTable: {
                            canned_food: 0.2,
                            fresh_fruit: 0.15,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            bandage: 0.15,
                            knife: 0.1,
                            junk: 0.05
                        },
                        zombieChance: 0.25
                    },
                    guglovo: {
                        name: 'Guglovo',
                        description: 'A rural village surrounded by farmland and forests.',
                        connections: ['stary_sobor', 'mogilevka', 'staroye', 'novy_sobor'],
                        lootTable: {
                            canned_food: 0.25,
                            fresh_fruit: 0.2,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            fishing_rod: 0.1,
                            bandage: 0.1
                        },
                        zombieChance: 0.2
                    },
                    mogilevka: {
                        name: 'Mogilevka',
                        description: 'A farming community with barns and agricultural equipment.',
                        connections: ['guglovo', 'staroye', 'elektro'],
                        lootTable: {
                            canned_food: 0.2,
                            fresh_fruit: 0.25,
                            water_bottle: 0.2,
                            junk: 0.15,
                            knife: 0.1,
                            bandage: 0.1
                        },
                        zombieChance: 0.2
                    },
                    staroye: {
                        name: 'Staroye',
                        description: 'An old village with traditional houses and a small church.',
                        connections: ['mogilevka', 'elektro', 'tulga', 'guglovo'],
                        lootTable: {
                            canned_food: 0.2,
                            fresh_fruit: 0.2,
                            water_bottle: 0.25,
                            soda_can: 0.15,
                            bandage: 0.15,
                            knife: 0.05
                        },
                        zombieChance: 0.15
                    },
                    tulga: {
                        name: 'Tulga',
                        description: 'A hillside village overlooking the coast. Isolated but scenic.',
                        connections: ['staroye', 'kamyshovo', 'solnichniy'],
                        lootTable: {
                            canned_food: 0.25,
                            fresh_fruit: 0.2,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            fishing_rod: 0.15,
                            bandage: 0.05
                        },
                        zombieChance: 0.15
                    },
                    
                    // Western Region
                    pavlovo: {
                        name: 'Pavlovo',
                        description: 'A military town with a base and vehicle maintenance facilities.',
                        connections: ['zelenogorsk', 'kamenka', 'kozlovka'],
                        lootTable: {
                            military_rations: 0.2,
                            energy_drink: 0.15,
                            medical_supplies: 0.15,
                            pistol: 0.1,
                            rifle: 0.1,
                            mosinRifle: 0.05,
                            junk: 0.15,
                            backpack: 0.05
                        },
                        zombieChance: 0.45
                    },
                    kozlovka: {
                        name: 'Kozlovka',
                        description: 'A small western village with a few houses and a store.',
                        connections: ['pavlovo', 'pogorevka', 'zelenogorsk'],
                        lootTable: {
                            canned_food: 0.25,
                            fresh_fruit: 0.2,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            bandage: 0.15,
                            knife: 0.05
                        },
                        zombieChance: 0.2
                    },
                    pogorevka: {
                        name: 'Pogorevka',
                        description: 'A remote village in the western forests. Very quiet and isolated.',
                        connections: ['kozlovka', 'myshkino', 'vybor', 'zelenogorsk', 'lopatino'],
                        lootTable: {
                            canned_food: 0.2,
                            fresh_fruit: 0.25,
                            water_bottle: 0.25,
                            fishing_rod: 0.15,
                            knife: 0.1,
                            bandage: 0.05
                        },
                        zombieChance: 0.1
                    },
                    
                    // Existing locations (keeping your originals but fixing the duplicate NWAF)
                    elektro: {
                        name: 'Elektrozavodsk',
                        description: 'A coastal city with industrial buildings and residential areas. The sound of waves can be heard nearby.',
                        connections: ['cherno', 'prigorodki', 'kamyshovo', 'staroye', 'mogilevka'],
                        lootTable: {
                            brassKnuckles: 0.15,
                            canned_food: 0.25,
                            protein_bar: 0.15,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            bandage: 0.1,
                            junk: 0.05,
                            knife: 0.05,
                            pistol: 0.05
                        },
                        zombieChance: 0.3
                    },
                    cherno: {
                        name: 'Chernogorsk',
                        description: 'A large coastal city with apartment buildings and shops. Many places to search for supplies.',
                        connections: ['elektro', 'balota', 'prigorodki', 'kamenka', 'komarovo'],
                        lootTable: {
                            canned_food: 0.2,
                            protein_bar: 0.15,
                            fresh_fruit: 0.1,
                            water_bottle: 0.15,
                            soda_can: 0.1,
                            bandage: 0.1,
                            medical_supplies: 0.1,
                            pistol: 0.08,
                            knife: 0.02
                        },
                        zombieChance: 0.4
                    },
                    kamyshovo: {
                        name: 'Kamyshovo',
                        description: 'A small coastal town with a few houses and a dock. Quiet but potentially dangerous.',
                        connections: ['elektro', 'solnichniy', 'prigorodki', 'tulga'],
                        lootTable: {
                            canned_food: 0.2,
                            fresh_fruit: 0.15,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            fishing_rod: 0.15,
                            bandage: 0.1,
                            knife: 0.05
                        },
                        zombieChance: 0.2
                    },
                    solnichniy: {
                        name: 'Solnichniy Factory',
                        description: 'An industrial area with large factory buildings. Good for finding tools and supplies.',
                        connections: ['kamyshovo', 'berezino', 'svetlojarsk', 'polana', 'tulga', 'rify'],
                        lootTable: {
                            canned_food: 0.15,
                            protein_bar: 0.15,
                            water_bottle: 0.15,
                            energy_drink: 0.1,
                            junk: 0.2,
                            bandage: 0.1,
                            knife: 0.1,
                            pistol: 0.05
                        },
                        zombieChance: 0.35
                    },
                    berezino: {
                        name: 'Berezino',
                        description: 'A coastal town with residential buildings and a hospital. Medical supplies might be found here.',
                        connections: ['solnichniy', 'svetlojarsk', 'novodmitrovsk', 'polana', 'gorka', 'rify', 'krasnostav'],
                        lootTable: {
                            canned_food: 0.15,
                            brassKnuckles: 0.15,
                            protein_bar: 0.1,
                            water_bottle: 0.15,
                            soda_can: 0.1,
                            medical_supplies: 0.2,
                            antibiotics: 0.1,
                            bandage: 0.15,
                            backpack: 0.05
                        },
                        zombieChance: 0.25
                    },
                    balota: {
                        name: 'Balota Airfield',
                        description: 'An abandoned airfield with hangars and barracks. High-value loot but very dangerous.',
                        connections: ['cherno', 'komarovo', 'kamenka', 'pavlovo'],
                        lootTable: {
                            military_rations: 0.2,
                            energy_drink: 0.15,
                            medical_supplies: 0.15,
                            antibiotics: 0.1,
                            bandage: 0.1,
                            pistol: 0.1,
                            rifle: 0.1,
                            backpack: 0.1,
                            mosinRifle: 0.05
                        },
                        zombieChance: 0.6
                    },
                    novodmitrovsk: {
                        name: 'Novodmitrovsk',
                        description: 'A large industrial city in the northeast. Factories and warehouses offer ample loot but attract many infected.',
                        connections: ['berezino', 'svetlojarsk', 'severograd'],
                        lootTable: {
                            canned_food: 0.15,
                            protein_bar: 0.15,
                            water_bottle: 0.15,
                            energy_drink: 0.1,
                            junk: 0.2,
                            medical_supplies: 0.1,
                            pistol: 0.1,
                            backpack: 0.05
                        },
                        zombieChance: 0.45
                    },
                    svetlojarsk: {
                        name: 'Svetlojarsk',
                        description: 'A coastal town in the north with a mix of homes and small businesses. The cold wind carries distant moans.',
                        connections: ['solnichniy', 'berezino', 'novodmitrovsk', 'severograd', 'rify', 'krasnostav'],
                        lootTable: {
                            canned_food: 0.2,
                            fresh_fruit: 0.15,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            bandage: 0.1,
                            knife: 0.1,
                            fishing_rod: 0.05,
                            pistol: 0.05
                        },
                        zombieChance: 0.3
                    },
                    zelenogorsk: {
                        name: 'Zelenogorsk',
                        description: 'An inland town with a military checkpoint. Good for military gear but risky due to patrols.',
                        connections: ['cherno', 'vybor', 'myshkino', 'novy_sobor', 'pavlovo', 'pogorevka'],
                        lootTable: {
                            military_rations: 0.2,
                            energy_drink: 0.15,
                            medical_supplies: 0.15,
                            antibiotics: 0.1,
                            bandage: 0.1,
                            pistol: 0.1,
                            rifle: 0.1,
                            backpack: 0.05
                        },
                        zombieChance: 0.5
                    },
                    komarovo: {
                        name: 'Komarovo',
                        description: 'A small coastal village with quaint houses. A quiet place, but resources are scarce.',
                        connections: ['balota', 'kamenka', 'cherno'],
                        lootTable: {
                            canned_food: 0.2,
                            fresh_fruit: 0.2,
                            water_bottle: 0.25,
                            soda_can: 0.15,
                            fishing_rod: 0.15,
                            bandage: 0.05
                        },
                        zombieChance: 0.15
                    },
                    kamenka: {
                        name: 'Kamenka',
                        description: 'A remote coastal village at the edge of Chernarus. Isolated but peaceful, with few supplies.',
                        connections: ['komarovo', 'balota', 'zelenogorsk', 'cherno', 'pavlovo'],
                        lootTable: {
                            canned_food: 0.25,
                            fresh_fruit: 0.2,
                            water_bottle: 0.25,
                            soda_can: 0.15,
                            fishing_rod: 0.15
                        },
                        zombieChance: 0.1
                    },
                    prigorodki: {
                        name: 'Prigorodki',
                        description: 'A small suburb near Elektrozavodsk. Scattered homes and a few stores offer modest loot.',
                        connections: ['elektro', 'cherno', 'kamyshovo', 'staroye'],
                        lootTable: {
                            canned_food: 0.25,
                            protein_bar: 0.15,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            bandage: 0.15,
                            junk: 0.05,
                            knife: 0.05
                        },
                        zombieChance: 0.25
                    },
                    novy_sobor: {
                        name: 'Novy Sobor',
                        description: 'An inland village with a church and small market. A good stop for basic supplies.',
                        connections: ['prigorodki', 'zelenogorsk', 'vybor', 'severograd', 'stary_sobor', 'kabanino', 'guglovo'],
                        lootTable: {
                            canned_food: 0.25,
                            fresh_fruit: 0.15,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            bandage: 0.15,
                            fishing_rod: 0.05,
                            knife: 0.05
                        },
                        zombieChance: 0.2
                    },
                    vybor: {
                        name: 'Vybor',
                        description: 'A central town with a military base nearby. High-value loot but heavily infested with infected.',
                        connections: ['zelenogorsk', 'novy_sobor', 'myshkino', 'nwaf', 'lopatino', 'kabanino', 'stary_sobor'],
                        lootTable: {
                            military_rations: 0.2,
                            energy_drink: 0.15,
                            medical_supplies: 0.15,
                            antibiotics: 0.1,
                            bandage: 0.1,
                            pistol: 0.1,
                            rifle: 0.1,
                            junk: 0.05
                        },
                        zombieChance: 0.55
                    },
                    myshkino: {
                        name: 'Myshkino',
                        description: 'A remote western village surrounded by forests.',
                        connections: ['zelenogorsk', 'vybor', 'lopatino', 'pogorevka'],
                        lootTable: {
                            canned_food: 0.25,
                            fresh_fruit: 0.2,
                            water_bottle: 0.2,
                            soda_can: 0.15,
                            fishing_rod: 0.15,
                            bandage: 0.05
                        },
                        zombieChance: 0.15
                    },
                    severograd: {
                        name: 'Severograd',
                        description: 'A northern industrial town with factories and a hospital.',
                        connections: ['novodmitrovsk', 'svetlojarsk', 'novaya_petrovka', 'novy_sobor', 'gorka', 'kamensk', 'krasnostav'],
                        lootTable: {
                            canned_food: 0.15,
                            protein_bar: 0.15,
                            water_bottle: 0.15,
                            energy_drink: 0.1,
                            medical_supplies: 0.2,
                            junk: 0.1,
                            bandage: 0.1,
                            pistol: 0.1,
                            backpack: 0.05
                        },
                        zombieChance: 0.4
                    }
                };

                this.gameRunning = true;
                this.timeCounter = 0;
                this.actionInProgress = false; // Tracks if an action is ongoing
                this.actionDuration = 3000; // Action duration in milliseconds (3 seconds)
                //this.init();
                self = this;
                document.getElementById("startBtn").addEventListener("click", function(e) {
                    e.preventDefault();
                    self.init();
                });
            }
            
            equipWeapon(weaponId) {
                if (this.actionInProgress) return;
                if (this.player.inventory.includes(weaponId) && this.weapons[weaponId]) {
                    this.startAction(`Equipping ${this.weapons[weaponId].name}...`, () => {
                        this.player.score += 50;
                        this.player.equippedWeapon = weaponId;
                        this.updateStory(`You equipped the ${this.weapons[weaponId].name}.`);
                        this.updateDisplay();
                        this.generateActions();
                    });
                }
            }

            setupTooltips() {
                const tooltip = document.getElementById('tooltip');
                const mapLocations = document.querySelectorAll('.map-location');

                mapLocations.forEach(location => {
                    location.addEventListener('mousemove', (e) => {
                        if (this.actionInProgress) return; // Don't show tooltips during actions
                        const tooltipText = location.getAttribute('data-tooltip');
                        if (tooltipText) {
                            tooltip.textContent = tooltipText;
                            tooltip.style.display = 'block';
                            // Position tooltip near cursor, offset to avoid covering the marker
                            tooltip.style.left = `${e.pageX + 10}px`;
                            tooltip.style.top = `${e.pageY - 40}px`;
                        }
                    });

                    location.addEventListener('mouseleave', () => {
                        tooltip.style.display = 'none';
                    });
                });
            }

            init() {
                document.getElementById("start").remove();
                this.updateDisplay();
                this.generateActions();
                setInterval(() => this.tick(), 3000);
                this.setupTooltips();
            }

            tick() {
                if (!this.gameRunning) return;
                
                this.timeCounter++;
                
                // Decrease hunger and thirst over time
                if (this.timeCounter % 4 === 0) {
                    this.player.hunger = Math.max(0, this.player.hunger - 1);
                    this.player.thirst = Math.max(0, this.player.thirst - 2);
                }
                
                // Health effects from hunger/thirst
                if (this.player.hunger <= 20 || this.player.thirst <= 20) {
                    this.player.health = Math.max(0, this.player.health - 1);
                }
                
                this.player.score += 1;
                this.checkGameOver();
                this.updateDisplay();
            }

            updateDisplay() {
                document.getElementById('health-bar').style.width = this.player.health + '%';
                document.getElementById('hunger-bar').style.width = this.player.hunger + '%';
                document.getElementById('thirst-bar').style.width = this.player.thirst + '%';
                
                document.getElementById('health-text').textContent = `${this.player.health}/100`;
                document.getElementById('hunger-text').textContent = `${this.player.hunger}/100`;
                document.getElementById('thirst-text').textContent = `${this.player.thirst}/100`;
                
                document.getElementById('score-text').textContent = `${this.player.score}pts`;
                
                const loc = this.locations[this.player.location];
                document.getElementById('location-name').textContent = "Location: " + loc.name;
                document.getElementById('location-description').textContent = loc.description;
                
                console.log(this.player.score);
                
                const startLocationEl = document.getElementById('start-location');
                if (startLocationEl && !startLocationEl.textContent) {
                    startLocationEl.textContent = loc.name;
                }
                
                this.updateMap();
                
                const inventoryEl = document.getElementById('inventory-items');
                if (this.player.inventory.length === 0) {
                    inventoryEl.innerHTML = '<div class="inventory-item">Empty Hands</div>';
                } else {
                    inventoryEl.innerHTML = this.player.inventory.map(item => 
                        `<div class="inventory-item" onclick="game.useItem('${item}')" style="cursor: pointer;">${this.formatItemName(item)}${this.player.equippedWeapon === item ? ' (Equipped)' : ''}</div>`
                    ).join('');
                }

                // Display equipped weapon
                const inventoryTitle = document.querySelector('.inventory-title');
                if (inventoryTitle) {
                    inventoryTitle.textContent = `Inventory (Weapon: ${this.player.equippedWeapon ? this.weapons[this.player.equippedWeapon].name : 'None'})`;
                }
            }
            
            updateMap() {
                // Reset all map locations
                Object.keys(this.locations).forEach(locId => {
                    const mapEl = document.getElementById(`map-${locId}`);
                    if (mapEl) {
                        mapEl.className = `map-location map-${locId}`;
                    }
                });

                // Highlight current location
                const currentMapEl = document.getElementById(`map-${this.player.location}`);
                if (currentMapEl) {
                    currentMapEl.classList.add('current');
                }

                // Highlight connected locations
                const currentLoc = this.locations[this.player.location];
                currentLoc.connections.forEach(connection => {
                    const connectedMapEl = document.getElementById(`map-${connection}`);
                    if (connectedMapEl) {
                        connectedMapEl.classList.add('connected');
                    }
                });

                // Draw roads
                const svg = document.querySelector('.map-roads');
                const map = document.getElementById('map');
                const mapRect = map.getBoundingClientRect();
                svg.setAttribute('width', mapRect.width);
                svg.setAttribute('height', mapRect.height);
                svg.innerHTML = '';
                currentLoc.connections.forEach(connection => {
                    const fromEl = document.getElementById(`map-${this.player.location}`);
                    const toEl = document.getElementById(`map-${connection}`);
                    if (fromEl && toEl) {
                        const fromRect = fromEl.getBoundingClientRect();
                        const toRect = toEl.getBoundingClientRect();
                        const x1 = fromRect.left + fromRect.width / 2 - mapRect.left;
                        const y1 = fromRect.top + fromRect.height / 2 - mapRect.top;
                        const x2 = toRect.left + toRect.width / 2 - mapRect.left;
                        const y2 = toRect.top + toRect.height / 2 - mapRect.top;
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', x1);
                        line.setAttribute('y1', y1);
                        line.setAttribute('x2', x2);
                        line.setAttribute('y2', y2);
                        line.setAttribute('stroke', '#ab4cde');
                        line.setAttribute('stroke-width', '2');
                        svg.appendChild(line);
                    }
                });
            }

            updateStatus() {
                if (this.player.infection) {
                    this.player.health = Math.max(0, this.player.health - 5); // 5 damage per action
                    this.updateStory('<span class="danger">Your infection worsens, draining your health!</span>');
                    if (this.player.health <= 0) {
                        this.checkGameOver();
                    }
                }
                this.updateDisplay();
            }

            mapTravel(destination) {
                const currentLocation = this.player.location;
                const allowedConnections = this.locations[currentLocation].connections;

                if (!allowedConnections.includes(destination)) {
                    this.updateStory(`<span class="warning">You cannot travel directly from ${this.locations[currentLocation].name} to ${this.locations[destination].name}.</span>`);
                    return;
                }

                this.startAction(`Traveling to ${this.locations[destination].name}...`, () => {
                    this.player.location = destination;
                    this.updateStory(`You have arrived at ${this.locations[destination].name}.`);

                    if (Math.random() < 0.5) {
                        const damage = this.player.equippedWeapon ? this.weapons[this.player.equippedWeapon].damage : this.player.baseDamage;
                        this.updateStory(`<span class="danger">You were ambushed by a zombie on the way!</span> You fight back, dealing ${damage} damage.`);
                        this.player.health = Math.max(0, this.player.health - 20);

                        if (Math.random() < 0.15 && !this.player.infection) { // 20% chance to get infected
                            this.player.infection = true;
                            this.updateStory('<span class="danger">The zombie’s bite infects you! Find antibiotics!</span>');
                        }

                        if (damage < 50) {
                            this.updateStory('The zombie survives your attack and injures you.');
                        } else {
                            this.updateStory('You defeated the zombie!');
                            this.player.score += 25;
                        }
                    }

                    this.player.hunger = Math.max(0, this.player.hunger - 15);
                    this.player.thirst = Math.max(0, this.player.thirst - 15);
                    this.updateStatus();
                    this.updateDisplay();
                    this.generateActions();
                });
            }

            isUsableItem(item) {
                return ['canned_food', 'water_bottle', 'bandage', 'medical_supplies', 'military_rations'].includes(item);
            }
    
            formatItemName(item) {
                const itemNames = {
                    canned_food: 'Canned Food',
                    protein_bar: 'Protein Bar',
                    fresh_fruit: 'Fresh Fruit',
                    military_rations: 'Military Rations',
                    water_bottle: 'Water Bottle',
                    soda_can: 'Soda Can',
                    energy_drink: 'Energy Drink',
                    bandage: 'Bandage',
                    medical_supplies: 'Medical Supplies',
                    antibiotics: 'Antibiotics',
                    fishing_rod: 'Fishing Rod',
                    junk: 'Junk',
                    backpack: 'Backpack'
                };
                if (this.weapons[item]) {
                    return this.weapons[item].name;
                }
                return itemNames[item] || item.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            }

            generateActions() {
                if (!this.gameRunning) return;
                const actionsEl = document.getElementById('action-buttons');
                actionsEl.innerHTML = '';

                const loc = this.locations[this.player.location];
                const buttons = [];

                // Search action
                buttons.push({ text: 'Search Area', action: `game.searchArea()`, disabled: this.actionInProgress });

                // Travel actions
                loc.connections.forEach(conn => {
                    /*buttons.push({
                        text: `Travel to ${this.locations[conn].name}`,
                        action: `game.mapTravel('${conn}')`,
                        disabled: this.actionInProgress
                    });*/
                });

                // Use item actions
                this.player.inventory.forEach(item => {
                    if (this.isUsableItem(item)) {
                        buttons.push({
                            text: `Use ${this.formatItemName(item)}`,
                            action: `game.useItem('${item}')`,
                            disabled: this.actionInProgress
                        });
                    }
                    // Equip weapon action
                    if (this.weapons[item] && item !== this.player.equippedWeapon) {
                        buttons.push({
                            text: `Equip ${this.weapons[item].name}`,
                            action: `game.equipWeapon('${item}')`,
                            disabled: this.actionInProgress
                        });
                    }
                });

                buttons.forEach(btn => {
                    const button = document.createElement('button');
                    button.className = 'action-btn';
                    button.textContent = btn.text;
                    button.setAttribute('onclick', btn.action);
                    if (btn.disabled) button.disabled = true;
                    actionsEl.appendChild(button);
                });
            }
    
            getRandomLoot(lootTable) {
                const rand = Math.random();
                let cumulative = 0;
                for (const [item, probability] of Object.entries(lootTable)) {
                    cumulative += probability;
                    if (rand <= cumulative) {
                        return item;
                    }
                }
                return Object.keys(lootTable)[0]; // Fallback to first item if something goes wrong
            }
            
            updateStory(message) {
                const storyEl = document.getElementById('story-text');
                if (!storyEl) return; // Safety check

                // Create new story entry
                const newEntry = document.createElement('div');
                newEntry.innerHTML = message;
                newEntry.style.marginTop = '16px';
                newEntry.style.color = 'lightgreen';

                storyEl.appendChild(newEntry);

                setTimeout(() => {
                  newEntry.style.color = 'white';
                }, 2500);
                
                // Scroll to bottom
                storyEl.scrollTop = storyEl.scrollHeight;
            }

            getWeightedRandomItem(lootTable, noLootChance = 0.2) {
                if (!lootTable || Object.keys(lootTable).length === 0) return null;

                // Apply no loot chance
                if (Math.random() < noLootChance) return null;

                // Calculate total weight
                const totalWeight = Object.values(lootTable).reduce((sum, weight) => sum + weight, 0);
                if (totalWeight <= 0) return null;

                // Generate random value between 0 and totalWeight
                let random = Math.random() * totalWeight;
                
                // Select item based on cumulative weight
                for (const [item, weight] of Object.entries(lootTable)) {
                    random -= weight;
                    if (random <= 0) return item;
                }
                
                // Fallback: return null if no item selected (edge case)
                return null;
            }

            startAction(actionText, callback) {
                const timerContainer = document.getElementById('timer-container');
                const timerText = document.getElementById('timer-text');
                const timerFill = document.getElementById('timer-fill');
                
                this.actionInProgress = true;
                let countdown = Math.ceil(this.actionDuration / 1000);
                
                // Set initial timer state
                timerText.textContent = `${actionText} ${countdown}s`;
                timerContainer.style.display = 'flex';
                timerFill.style.width = '100%'; // Ensure initial width
                
                // Force reflow to register initial state
                timerFill.offsetWidth; // Trigger reflow
                
                // Start animation
                timerFill.style.transition = `width ${this.actionDuration}ms linear`;
                timerFill.style.width = '0%';
                
                // Update countdown text every second
                const countdownInterval = setInterval(() => {
                    countdown--;
                    timerText.textContent = `${actionText} ${countdown}s`;
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                    }
                }, 1000);
                
                // Complete action after duration
                setTimeout(() => {
                    timerContainer.style.display = 'none';
                    timerFill.style.transition = 'none'; // Reset transition
                    timerFill.style.width = '100%'; // Reset width
                    this.actionInProgress = false;
                    callback();
                }, this.actionDuration);
            }

            searchArea() {
                this.startAction('Searching area...', () => {
                    const loc = this.locations[this.player.location];
                    const noLootChance = loc.zombieChance > 0.5 ? 0.3 : 0.2;
                    const loot = this.getWeightedRandomItem(loc.lootTable, noLootChance);
                    if (loot && this.player.inventory.length < this.player.inventoryCapacity) {
                        this.player.inventory.push(loot);
                        this.updateStory(`You found ${this.formatItemName(loot)}!`);
                        this.player.score += 10;
                    } else {
                        this.updateStory('You searched but found nothing useful.');
                    }
                    if (Math.random() < loc.zombieChance) {
                        const damage = this.player.equippedWeapon ? this.weapons[this.player.equippedWeapon].damage : this.player.baseDamage;
                        this.updateStory(`<span class="danger">A zombie appears and attacks!</span> You fight back, dealing ${damage} damage.`);
                        this.player.health = Math.max(0, this.player.health - 30);
                        if (Math.random() < 0.2 && !this.player.infection) { // 20% chance to get infected
                            this.player.infection = true;
                            this.updateStory('<span class="danger">The zombie’s bite infects you! Find antibiotics!</span>');
                        }
                        if (damage < 50) {
                            this.updateStory('The zombie survives your attack and injures you.');
                        } else {
                            this.updateStory('You defeated the zombie!');
                            this.player.score += 25;
                        }
                    }
                    this.updateStatus();
                    this.updateDisplay();
                    this.generateActions();
                });
            }

            zombieEncounter() {
                if (this.actionInProgress) {
                    document.getElementById('story-text').textContent = "You are already performing an action. Please wait.";
                    return;
                }

                const storyEl = document.getElementById('story-text');

                // Start action
                this.actionInProgress = true;
                this.disableInteractions();

                // Show timer
                const timerContainer = document.getElementById('timer-container');
                const timerFill = document.getElementById('timer-fill');
                const timerText = document.getElementById('timer-text');
                let countdown = Math.ceil(this.actionDuration / 1000);
                timerText.textContent = `Fighting zombie... ${countdown}`;
                timerContainer.style.display = 'flex';
                timerFill.style.transition = `width ${this.actionDuration}ms linear`;
                timerFill.style.width = '0%';

                // Countdown text
                const countdownInterval = setInterval(() => {
                    countdown--;
                    if (countdown > 0) {
                        timerText.textContent = `Fighting zombie... ${countdown}`;
                    }
                }, 1000);

                setTimeout(() => {
                    clearInterval(countdownInterval);
                    let damage = 0;
                    const encounterType = Math.random();
                    if (encounterType < 0.3) {
                        // 30% chance for multiple zombies
                        const zombieCount = Math.floor(Math.random() * 2) + 2; // 2-3 zombies
                        damage = Math.floor(Math.random() * 20 + 15) * zombieCount; // 15-35 damage per zombie
                        this.player.health = Math.max(0, this.player.health - damage);
                        storyEl.innerHTML = `<span class="danger">A group of ${zombieCount} zombies ambushes you!</span> You fight them off but take ${damage} damage. Your heart pounds as you catch your breath.`;
                        this.player.score += 20;
                    } else {
                        // 70% chance for single zombie
                        damage = Math.floor(Math.random() * 40) + 15; // 15-55 damage (increased from 10-40)
                        this.player.health = Math.max(0, this.player.health - damage);
                        storyEl.innerHTML = `<span class="danger">A zombie shambles out from the shadows!</span> You fight it off but take ${damage} damage. Your heart pounds as you catch your breath.`;
                        this.player.score += 20;
                    }

                    // Reset action state
                    this.actionInProgress = false;
                    timerContainer.style.display = 'none';
                    timerFill.style.transition = 'none';
                    timerFill.style.width = '100%';
                    this.enableInteractions();

                    this.checkGameOver();
                    this.updateDisplay();
                    this.generateActions();
                }, this.actionDuration);
            }

            travel(destination) {
                if (this.actionInProgress) {
                    document.getElementById('story-text').textContent = "You are already performing an action. Please wait.";
                    return;
                }

                const currentLoc = this.locations[this.player.location];
                const destName = this.locations[destination].name;
                
                if (!currentLoc.connections.includes(destination)) {
                    document.getElementById('story-text').textContent = "You can't reach that location from here. You need to find a connecting road.";
                    return;
                }

                // Show confirmation dialog
                const confirmTravel = confirm(`Do you want to travel to ${destName}?`);
                if (!confirmTravel) {
                    document.getElementById('story-text').textContent = `You decided to stay in ${currentLoc.name}.`;
                    return;
                }

                // Start action
                this.actionInProgress = true;
                this.disableInteractions();

                // Show timer
                const timerContainer = document.getElementById('timer-container');
                const timerFill = document.getElementById('timer-fill');
                const timerText = document.getElementById('timer-text');
                let countdown = Math.ceil(this.actionDuration / 1000);
                timerText.textContent = `Traveling to ${destName}... ${countdown}`;
                timerContainer.style.display = 'flex';
                timerFill.style.transition = `width ${this.actionDuration}ms linear`;
                timerFill.style.width = '0%';

                // Countdown text
                const countdownInterval = setInterval(() => {
                    countdown--;
                    if (countdown > 0) {
                        timerText.textContent = `Traveling to ${destName}... ${countdown}`;
                    }
                }, 1000);

                setTimeout(() => {
                    clearInterval(countdownInterval);
                    const storyEl = document.getElementById('story-text');

                    // Resource cost for travel
                    this.player.hunger = Math.max(0, this.player.hunger - 15);
                    this.player.thirst = Math.max(0, this.player.thirst - 15);

                    // Random encounter (50% chance)
                    const encounterChance = Math.random();
                    if (encounterChance < 0.25) {
                        // 25% chance for zombie encounter
                        this.zombieEncounter();
                    } else if (encounterChance < 0.4) {
                        // 15% chance for environmental hazard
                        const damage = Math.floor(Math.random() * 20) + 10; // 10-30 damage
                        this.player.health = Math.max(0, this.player.health - damage);
                        storyEl.innerHTML = `<span class="danger">You trip on rough terrain and injure yourself!</span> You take ${damage} damage while traveling to ${destName}.`;
                        this.checkGameOver();
                    } else if (encounterChance < 0.5) {
                        // 10% chance for hostile survivor encounter
                        const damage = Math.floor(Math.random() * 30) + 15; // 15-45 damage
                        this.player.health = Math.max(0, this.player.health - damage);
                        // Chance to lose an item
                        if (this.player.inventory.length > 0 && Math.random() < 0.5) {
                            const lostItem = this.player.inventory.splice(Math.floor(Math.random() * this.player.inventory.length), 1)[0];
                            storyEl.innerHTML = `<span class="danger">A hostile survivor ambushes you!</span> You fight them off but take ${damage} damage and lose your ${this.formatItemName(lostItem)}.`;
                            this.player.score += 25;
                        } else {
                            storyEl.innerHTML = `<span class="danger">A hostile survivor ambushes you!</span> You fight them off but take ${damage} damage.`;
                            this.player.score += 25;
                        }
                        this.checkGameOver();
                    } else {
                        // 50% chance for safe travel
                        this.player.location = destination;
                        storyEl.textContent = `You carefully make your way along the roads to ${destName}. The journey is tense, but you arrive safely.`;
                        this.player.score += 50;
                    }

                    // Reset action state
                    this.actionInProgress = false;
                    timerContainer.style.display = 'none';
                    timerFill.style.transition = 'none';
                    timerFill.style.width = '100%';
                    this.enableInteractions();

                    this.updateDisplay();
                    this.generateActions();
                }, this.actionDuration);
            }

            rest() {
                if (this.actionInProgress) {
                    document.getElementById('story-text').textContent = "You are already performing an action. Please wait.";
                    return;
                }

                const storyEl = document.getElementById('story-text');

                // Show confirmation dialog
                const confirmRest = confirm("Do you want to rest?");
                if (!confirmRest) {
                    storyEl.textContent = "You decided not to rest.";
                    return;
                }

                // Start action
                this.actionInProgress = true;
                this.disableInteractions();

                // Show timer
                const timerContainer = document.getElementById('timer-container');
                const timerFill = document.getElementById('timer-fill');
                const timerText = document.getElementById('timer-text');
                let countdown = Math.ceil(this.actionDuration / 1000);
                timerText.textContent = `Resting... ${countdown}`;
                timerContainer.style.display = 'flex';
                timerFill.style.transition = `width ${this.actionDuration}ms linear`;
                timerFill.style.width = '0%';

                // Countdown text
                const countdownInterval = setInterval(() => {
                    countdown--;
                    if (countdown > 0) {
                        timerText.textContent = `Resting... ${countdown}`;
                    }
                }, 1000);

                setTimeout(() => {
                    clearInterval(countdownInterval);
                    const healthGain = Math.min(20, 100 - this.player.health);
                    this.player.health = Math.min(100, this.player.health + healthGain);
                    this.player.hunger = Math.max(0, this.player.hunger - 10);
                    this.player.thirst = Math.max(0, this.player.thirst - 15);
                    
                    storyEl.textContent = `You find a safe spot and rest for a while, recovering ${healthGain} health. However, you're now more hungry and thirsty.`;
                    
                    // Reset action state
                    this.actionInProgress = false;
                    timerContainer.style.display = 'none';
                    timerFill.style.transition = 'none';
                    timerFill.style.width = '100%';
                    this.enableInteractions();
                    
                    this.updateDisplay();
                    this.generateActions();
                }, this.actionDuration);
            }

            useItem(item) {
                if (this.actionInProgress) return false;
                this.startAction(`Using ${this.formatItemName(item)}...`, () => {
                    const index = this.player.inventory.indexOf(item);
                    if (index !== -1) {
                        this.player.inventory.splice(index, 1);
                        switch (item) {
                            case 'canned_food':
                                this.player.hunger = Math.min(100, this.player.hunger + 40);
                                this.updateStory('You ate some canned food, feeling less hungry.');
                                this.player.score += 10;
                                break;
                            case 'protein_bar':
                                this.player.hunger = Math.min(100, this.player.hunger + 20);
                                this.updateStory('You ate a protein bar, a light snack.');
                                this.player.score += 10;
                                break;
                            case 'fresh_fruit':
                                this.player.hunger = Math.min(100, this.player.hunger + 15);
                                this.player.thirst = Math.min(100, this.player.thirst + 10);
                                this.player.health = Math.min(100, this.player.health + 5);
                                this.updateStory('You ate fresh fruit, feeling refreshed.');
                                this.player.score += 10;
                                break;
                            case 'military_rations':
                                this.player.hunger = Math.min(100, this.player.hunger + 60);
                                this.updateStory('You consumed military rations, feeling well-fed.');
                                this.player.score += 10;
                                break;
                            case 'water_bottle':
                                this.player.thirst = Math.min(100, this.player.thirst + 50);
                                this.updateStory('You drank a water bottle, quenching your thirst.');
                                this.player.score += 10;
                                break;
                            case 'soda_can':
                                this.player.thirst = Math.min(100, this.player.thirst + 30);
                                this.updateStory('You drank a soda can, feeling refreshed.');
                                this.player.score += 10;
                                break;
                            case 'energy_drink':
                                this.player.thirst = Math.min(100, this.player.thirst + 40);
                                this.player.hunger = Math.min(100, this.player.hunger + 10);
                                this.updateStory('You drank an energy drink, feeling energized.');
                                this.player.score += 10;
                                break;
                            case 'bandage':
                                this.player.health = Math.min(100, this.player.health + 30);
                                this.updateStory('You applied a bandage, stopping some bleeding.');
                                this.player.score += 15;
                                break;
                            case 'medical_supplies':
                                this.player.health = Math.min(100, this.player.health + 50);
                                this.updateStory('You used medical supplies, restoring significant health.');
                                this.player.score += 20;
                                break;
                            case 'antibiotics':
                                this.player.infection = false; // Clear infection
                                this.updateStory('You took antibiotics, curing your infection.');
                                this.player.score += 100;
                                break;
                            case 'backpack':
                                this.player.inventoryCapacity = 12; // Increase from 8
                                this.updateStory('You equipped a backpack, increasing your inventory capacity.');
                                this.player.score += 15;
                                break;
                            }
                        this.updateStatus();
                        this.updateDisplay();
                        this.generateActions();
                    }
                });
            }

            checkGameOver() {
                if (this.player.health <= 0) {
                    this.gameRunning = false;
                    document.getElementById('story-text').innerHTML = 
                        '<div class="game-over">You Died<br><span style="color:orange;">SCORE: ' + this.player.score + 'pts</span></div>';
                    var score = 0;
                    setInterval(function() { 
                      document.getElementById('action-buttons').remove();
                      document.getElementById('map').remove();
                      document.getElementById('inventory-items').remove();
                    }, 10);
                }
            }
            
            disableInteractions() {
                // Disable action buttons
                document.querySelectorAll('.action-btn').forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('disabled');
                });
                
                // Disable inventory items
                document.querySelectorAll('.inventory-item').forEach(item => {
                    item.style.pointerEvents = 'none';
                    item.style.opacity = '0.5';
                });
                
                // Disable map locations
                document.querySelectorAll('.map-location').forEach(loc => {
                    loc.style.pointerEvents = 'none';
                    loc.style.opacity = '0.5';
                });
            }

            enableInteractions() {
                // Enable action buttons
                document.querySelectorAll('.action-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                });
                
                // Enable inventory items
                document.querySelectorAll('.inventory-item').forEach(item => {
                    item.style.pointerEvents = 'auto';
                    item.style.opacity = '1';
                });
                
                // Enable map locations
                document.querySelectorAll('.map-location').forEach(loc => {
                    loc.style.pointerEvents = 'auto';
                    loc.style.opacity = '1';
                });
            }
        }

        // Start the game
        const game = new Game();
    </script>
</body>
</html>